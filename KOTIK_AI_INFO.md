KOTIK-AI-MVP-DOCUMENTATION.md`,
      `content`: `# KOTIK AI - MVP База знаний: Полная документация проекта

**Дата:** 27 августа 2025  
**Статус:** MVP система развернута и работает

---

## КРАТКОЕ СОДЕРЖАНИЕ ПРОЕКТА

Создана MVP система базы знаний для Telegram бота Kotik AI с архитектурой PostgreSQL + AI-обогащенные данные.

**Ключевые достижения:**
- Создана гибкая архитектура БД из 3 таблиц
- Обработано 5 ресторанов с AI-описаниями по 1000 символов
- Загружено 150+ отзывов со структурированными данными  
- Настроено подключение к Supabase PostgreSQL
- Создана система автоматической загрузки данных

---

## АРХИТЕКТУРА БАЗЫ ДАННЫХ

### Схема: `kotik_mvp`

#### 1. Таблица `entities` (Основная)
**Назначение:** Хранение всех типов сущностей (рестораны, отели, гайды)

```sql
- id (SERIAL PRIMARY KEY) - уникальный идентификатор
- google_place_id (VARCHAR UNIQUE) - ID Google Maps для дедупликации
- entity_type (VARCHAR) - тип сущности ('restaurant', 'hotel', 'guide')
- title (VARCHAR) - название заведения
- address (TEXT) - полный адрес
- location (GEOGRAPHY) - GPS координаты (PostGIS)
- contacts (JSONB) - контактная информация
- rating_overall (NUMERIC) - общий рейтинг
- reviews_count (INTEGER) - количество отзывов
- details (JSONB) - специфические данные
- summary_main (TEXT) - AI-описание ~1000 символов
- summary_reviews (TEXT) - AI-саммари отзывов
- tags (TEXT[]) - теги для поиска
- version (INTEGER) - версия записи
- created_at, updated_at - временные метки
```

#### 2. Таблица `reviews` (Отзывы)
**Назначение:** Хранение отзывов пользователей

```sql
- id (SERIAL PRIMARY KEY)
- entity_id (INTEGER FK) - ссылка на entities
- review_text (TEXT) - текст отзыва
- rating (INTEGER 1-5) - оценка
- review_date (DATE) - дата отзыва
- original_language (VARCHAR) - язык отзыва
- review_context (JSONB) - дополнительная информация
- source (VARCHAR) - источник отзыва
```

#### 3. Таблица `entity_connections` (Связи)
**Назначение:** Связи между сущностями для рекомендаций

```sql
- id (SERIAL PRIMARY KEY)
- entity_from_id (INTEGER FK) - от какой сущности
- entity_to_id (INTEGER FK) - к какой сущности
- connection_type (VARCHAR) - тип связи
- connection_strength (NUMERIC) - сила связи 0.00-1.00
- created_at - когда создана связь
```

---

## КРИТИЧНЫЕ НАСТРОЙКИ И ДОСТУПЫ

### Supabase PostgreSQL
```
Host: aws-1-us-east-2.pooler.supabase.com
Port: 5432
Database: postgres
User: postgres.pqvdqkcamyutgazskekz
Password: B8kscArA3Gr9Grv4
Project ID: pqvdqkcamyutgazskekz
```

### API Ключи
```
хранятся на локальном компе

---

## ФАЙЛЫ ПРОЕКТА И ИХ НАЗНАЧЕНИЕ

### Локальное расположение: `/Users/user1/Downloads/`

#### SQL Схемы:
- **`schema.sql`** - Создание структуры базы данных
  - Создает схему kotik_mvp и все таблицы
  - Устанавливает индексы и ограничения

#### Python Скрипты:
- **`process_restaurants_extended_data.py`** - Обработка сырых данных через OpenAI
  - Читает JSON файлы от Google Maps скрапера
  - Генерирует AI-описания через OpenAI (1000 символов)
  - Создает структурированные саммари отзывов

- **`load_to_db_final.py`** - ФИНАЛЬНЫЙ рабочий скрипт загрузки
  - Использует проверенные настройки подключения
  - Выполняет UPSERT операции с версионированием
  - Обрабатывает отзывы и связи

#### Скрипты диагностики:
- **`test_new_password.py`** - Проверка подключения к БД
- **`diagnose_connection.py`** - Диагностика различных вариантов подключения

#### Данные:
- **`restaurants_final_structured_extended.json`** - Обработанные данные ресторанов
  - 5 ресторанов с полной структурой
  - AI-описания по 1000 символов
  - ~150 отзывов со всеми деталями

---

## АЛГОРИТМ ЗАГРУЗКИ НОВЫХ ДАННЫХ

### Этап 1: Получение сырых данных
1. Используйте Google Maps AI Scraper для сбора данных
2. Экспортируйте результат в JSON формат
3. Сохраните файл как `dataset_google-maps-scraper-task_YYYY-MM-DD.json`

### Этап 2: AI-обогащение данных (локально)
```bash
cd ~/Downloads
python3 process_restaurants_extended_data.py
```

**Что происходит:**
- Скрипт читает сырой JSON файл
- Для каждого ресторана анализирует ВСЕ отзывы (без ограничений)
- Генерирует через OpenAI:
  - Детальное описание ~1000 символов
  - Саммари отзывов ~300 символов
- Извлекает теги и ключевые слова
- Создает финальный JSON с обогащенными данными

### Этап 3: Загрузка в базу данных
```bash
cd ~/Downloads
python3 load_to_db_final.py
```

**Что происходит:**
- Подключается к Supabase PostgreSQL
- Выполняет UPSERT операции (обновляет существующие, создает новые)
- Удаляет старые отзывы и вставляет свежие
- Увеличивает версию записи при обновлении
- Обрабатывает данные батчами для стабильности

### Проверка результата:
```sql
-- В Supabase SQL Editor
SELECT COUNT(*) FROM kotik_mvp.entities; -- Количество сущностей
SELECT COUNT(*) FROM kotik_mvp.reviews;  -- Количество отзывов
SELECT title, rating_overall, reviews_count 
FROM kotik_mvp.entities 
ORDER BY rating_overall DESC;
```

---

## РЕШЕННЫЕ ТЕХНИЧЕСКИЕ ПРОБЛЕМЫ

### Проблема 1: Подключение к Supabase
**Решение:** Нашли правильные параметры подключения:
- Хост: aws-1-us-east-2.pooler.supabase.com (не eu-central!)
- Порт: 5432 (Session Pooler, не Transaction 6543)
- Сбросили и создали новый пароль базы данных

### Проблема 2: Качество AI-саммари
**Решение:** 
- Увеличили длину с 500 до 1000 символов
- Используем ВСЕ отзывы (до 30 на ресторан) без ограничений
- Подняли max_tokens до 2000 для детальности

### Проблема 3: Структура данных
**Решение:**
- Создали гибкую схему с JSONB полями
- Используем PostGIS для геолокации
- Реализовали UPSERT логику с версионированием

---

## ПЛАНЫ РАЗВИТИЯ

### Ближайшие задачи (Этап 2):

#### 1. Создание эмбедингов
```python
# Создать таблицу для векторов
CREATE TABLE entity_embeddings (
    entity_id INTEGER REFERENCES kotik_mvp.entities(id),
    description_embedding vector(1536),
    combined_embedding vector(1536)
);

# Скрипт генерации эмбедингов через OpenAI
python3 generate_embeddings.py
```

#### 2. Векторный поиск
- Настройка pgvector в Supabase
- Или интеграция с Pinecone для векторного поиска
- Создание API для семантического поиска

#### 3. Автоматические связи между сущностями
```sql
-- Геолокационные связи
INSERT INTO kotik_mvp.entity_connections 
SELECT e1.id, e2.id, 'nearby', distance_strength
FROM entities e1, entities e2 
WHERE ST_DWithin(e1.location, e2.location, 500);

-- Семантические связи через эмбединги
```

#### 4. Расширение данных
- Добавить отели в Каше
- Загрузить beach clubs
- Создать сущности-гайды (\"Лучшие пляжи Каша\")

### Долгосрочные цели:
- Интеграция с Telegram ботом
- Система рекомендаций на основе связей
- Автоматическое обновление данных
- Multi-modal поиск (текст + изображения)

---

## ТЕКУЩИЕ РЕЗУЛЬТАТЫ

### База данных:
- **Сущностей:** 5 ресторанов 
- **Отзывов:** 150+ структурированных отзывов
- **AI-описаний:** 5 детальных саммари по 1000 символов
- **Схема:** Готова к масштабированию

### Качество данных:
- Все 30 отзывов на ресторан используются в анализе
- AI-описания содержат конкретные детали: блюда, цены, владельцев
- Структурированные теги для поиска
- GPS координаты и контактная информация

### Стоимость обработки:
- ~$0.004-0.006 за ресторан с AI-обогащением
- ~$0.025 за полную обработку 5 ресторанов
- Масштабируется линейно

---

**Система готова к production использованию и дальнейшему развитию!**

*Создано с использованием Claude Sonnet 4*  
*Принцип: \"От сырых данных к умной системе знаний\"*`
    }
  ],
  `owner`: `salimovsf`,
  `branch`: `main`,
  `message`: `Создана полная документация MVP базы знаний Kotik AI с настройками и планами`
}
